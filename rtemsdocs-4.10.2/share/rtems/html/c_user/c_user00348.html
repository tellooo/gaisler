<HTML>
<!-- created Dec 13 2011 from rtmon.texi line 951 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>Rate Monotonic Manager Task with Multiple Periods</TITLE>
<LINK REL="Precedes" HREF="c_user00328.html">
<LINK REV="Precedes" HREF="c_user00347.html">
<LINK REV="Subdocument" HREF="c_user00327.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="c_user00347.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="c_user00327.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="c_user00328.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS C User's Guide</CITE></P>
<H3>19.3.8: Task with Multiple Periods</H3>
<P>
This example consists of a single periodic task
which, after initialization, performs two sets of actions every
100 clock ticks.  The first set of actions is performed in the
first forty clock ticks of every 100 clock ticks, while the
second set of actions is performed between the fortieth and
seventieth clock ticks.  The last thirty clock ticks are not
used by this task.
</P>
<DL><DT><DD>
<PRE>
rtems_task Periodic_task(rtems_task_argument arg)
{
  rtems_name        name_1, name_2;
  rtems_id          period_1, period_2;
  rtems_status_code status;

  name_1 = rtems_build_name( 'P', 'E', 'R', '1' );
  name_2 = rtems_build_name( 'P', 'E', 'R', '2' );

  (void ) rtems_rate_monotonic_create( name_1, &amp;period_1 );
  (void ) rtems_rate_monotonic_create( name_2, &amp;period_2 );

  while ( 1 ) {
    if ( rtems_rate_monotonic_period( period_1, 100 ) == TIMEOUT )
      break;

    if ( rtems_rate_monotonic_period( period_2, 40 ) == TIMEOUT )
      break;

    /*
     *  Perform first set of actions between clock
     *  ticks 0 and 39 of every 100 ticks.
     */

    if ( rtems_rate_monotonic_period( period_2, 30 ) == TIMEOUT )
      break;

    /*
     *  Perform second set of actions between clock 40 and 69
     *  of every 100 ticks.  THEN ...
     *
     *  Check to make sure we didn't miss the period_2 period.
     */

    if ( rtems_rate_monotonic_period( period_2, STATUS ) == TIMEOUT )
      break;

    (void) rtems_rate_monotonic_cancel( period_2 );
  }

  /* missed period so delete period and SELF */

  (void ) rtems_rate_monotonic_delete( period_1 );
  (void ) rtems_rate_monotonic_delete( period_2 );
  (void ) task_delete( SELF );
}
</PRE>
</DL>
<P>
The above task creates two rate monotonic periods as
part of its initialization.  The first time the loop is
executed, the <CODE>rtems_rate_monotonic_period</CODE>
directive will initiate the period_1 period for 100 ticks
and return immediately.  Subsequent invocations of the
<CODE>rtems_rate_monotonic_period</CODE> directive
for period_1 will result in the task blocking for the remainder
of the 100 tick period.  The period_2 period is used to control
the execution time of the two sets of actions within each 100
tick period established by period_1.  The
<CODE>rtems_rate_monotonic_cancel( period_2 )</CODE>
call is performed to ensure that the period_2 period
does not expire while the task is blocked on the period_1
period.  If this cancel operation were not performed, every time
the <CODE>rtems_rate_monotonic_period( period_2, 40 )</CODE>
call is executed, except for the initial one, a directive status
of <CODE>RTEMS_TIMEOUT</CODE> is returned.  It is important to
note that every time this call is made, the period_2 period will be
initiated immediately and the task will not block.
</P>
<P>
If, for any reason, the task misses any deadline, the
<CODE>rtems_rate_monotonic_period</CODE> directive will
return the <CODE>RTEMS_TIMEOUT</CODE>
directive status.  If the above task misses its deadline, it
will delete the rate monotonic periods and itself.
</P>
<P><HR>
<LINK REL="Precedes" HREF="c_user00328.html">
<LINK REV="Precedes" HREF="c_user00347.html">
<LINK REV="Subdocument" HREF="c_user00327.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="c_user00347.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="c_user00327.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="c_user00328.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS C User's Guide</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
