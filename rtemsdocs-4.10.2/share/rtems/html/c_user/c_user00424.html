<HTML>
<!-- created Dec 13 2011 from conf.texi line 2177 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>Configuring a System Sizing the RTEMS RAM Workspace</TITLE>
<LINK REL="Precedes" HREF="c_user00437.html">
<LINK REV="Precedes" HREF="c_user00015.html">
<LINK REV="Subdocument" HREF="c_user00043.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="c_user00015.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="c_user00043.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="c_user00437.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS C User's Guide</CITE></P>
<H2>23.13: Sizing the RTEMS RAM Workspace</H2>
<P>
The RTEMS RAM Workspace is a user-specified block of
memory reserved for use by RTEMS.  The application should NOT
modify this memory.  This area consists primarily of the RTEMS
data structures whose exact size depends upon the values
specified in the Configuration Table.  In addition, task stacks
and floating point context areas are dynamically allocated from
the RTEMS RAM Workspace.
</P>
<P>
The <CODE>rtems/confdefs.h</CODE> mechanism calcalutes the size
of the RTEMS RAM Workspace automatically.  It assumes that
all tasks are floating point and that all will be allocated
the miminum stack space.  This calculation also automatically
includes the memory that will be allocated for internal use
by RTEMS.  The following macros may be set
by the application to make the calculation
of memory required more accurate:
</P>
<UL>
<LI><CODE>CONFIGURE_MEMORY_OVERHEAD</CODE>
<LI><CODE>CONFIGURE_EXTRA_TASK_STACKS</CODE>

</UL>
<P>
The starting address of the RTEMS RAM Workspace must
be aligned on a four-byte boundary.  Failure to properly align
the workspace area will result in the
<CODE>rtems_fatal_error_occurred</CODE>
directive being invoked with the
<CODE>RTEMS_INVALID_ADDRESS</CODE> error code.
</P>
<P>
The file <CODE>&lt;rtems/confdefs.h&gt;</CODE> will calculate the
value that is specified as the <CODE>work_space_size</CODE>
parameter of the Configuration Table. There are many
parameters the application developer can specify to
help <CODE>&lt;rtems/confdefs.h&gt;</CODE> in its calculations.  Correctly
specifying the application requirements via parameters
such as <CODE>CONFIGURE_EXTRA_TASK_STACKS</CODE> and
<CODE>CONFIGURE_MAXIMUM_TASKS</CODE> is critical.
</P>
<P>
The allocation of objects can operate in two modes. The default mode
has an object number ceiling. No more than the specified number of
objects can be allocated from the RTEMS RAM Workspace. The number of objects
specified in the particular API Configuration table fields are
allocated at initialisation. The second mode allows the number of
objects to grow to use the available free memory in the RTEMS RAM Workspace.
</P>
<P>
The auto-extending mode can be enabled individually for each object
type by using the macro <CODE>rtems_resource_unlimited</CODE>. This takes a value
as a parameter, and is used to set the object maximum number field in
an API Configuration table. The value is an allocation unit size. When
RTEMS is required to grow the object table it is grown by this
size. The kernel will return the object memory back to the RTEMS RAM Workspace
when an object is destroyed. The kernel will only return an allocated
block of objects to the RTEMS RAM Workspace if at least half the allocation
size of free objects remain allocated. RTEMS always keeps one
allocation block of objects allocated. Here is an example of using
<CODE>rtems_resource_unlimited</CODE>:
</P>
<DL><DT><DD>
<PRE>
#define CONFIGURE_MAXIMUM_TASKS rtems_resource_unlimited(5)
</PRE>
</DL>
<P>
The user is cautioned that future versions of RTEMS may not have the
same memory requirements per object. Although the value calculated is
suficient for a particular target processor and release of RTEMS,
memory usage is subject to change across versions and target
processors.  To avoid problems, the user should accurately
specify each configuration parameter and allow
<CODE>&lt;rtems/confdefs.h&gt;</CODE> to calculate the memory requirements.
The memory requirements are likely to change each
time one of the following events occurs:
</P>
<UL>
<LI>a configuration parameter is modified,
<LI>task or interrupt stack requirements change,
<LI>task floating point attribute is altered,
<LI>RTEMS is upgraded, or
<LI>the target processor is changed.
</UL>

<P>
Failure to provide enough space in the RTEMS RAM
Workspace will result in the
<CODE>rtems_fatal_error_occurred</CODE> directive
being invoked with the appropriate error code.
</P>
<P><HR>
<LINK REL="Precedes" HREF="c_user00437.html">
<LINK REV="Precedes" HREF="c_user00015.html">
<LINK REV="Subdocument" HREF="c_user00043.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="c_user00015.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="c_user00043.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="c_user00437.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS C User's Guide</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
