<HTML>
<!-- created Dec 13 2011 from networkapp.texi line 497 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>Tapping Into an Interface</TITLE>
<LINK REL="Precedes" HREF="networking00029.html">
<LINK REV="Precedes" HREF="networking00027.html">
<LINK REV="Subdocument" HREF="networking00020.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="networking00027.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="networking00020.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="networking00029.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS Network Supplement</CITE></P>
<H3>3.4.2: Tapping Into an Interface</H3>
<P>
RTEMS add two new ioctls to the BSD networking code:
SIOCSIFTAP and SIOCGIFTAP.  These may be used to set and get a
<EM>tap function</EM>.  The tap function will be called for every
Ethernet packet received by the interface.
</P>
<P>
These are called like other interface ioctls, such as SIOCSIFADDR.
When setting the tap function with SIOCSIFTAP, set the ifr_tap field
of the ifreq struct to the tap function.  When retrieving the tap
function with SIOCGIFTAP, the current tap function will be returned in
the ifr_tap field.  To stop tapping packets, call SIOCSIFTAP with a
ifr_tap field of 0.
</P>
<P>
The tap function is called like this:
</P>
<DL><DT><DD>
<PRE>
int tap (struct ifnet *, struct ether_header *, struct mbuf *)
</PRE>
</DL>
<P>
The tap function should return 1 if the packet was fully handled, in
which case the caller will simply discard the mbuf.  The tap function
should return 0 if the packet should be passed up to the higher
networking layers.
</P>
<P>
The tap function is called with the network semaphore locked.  It must
not make any calls on the application levels of the networking level
itself.  It is safe to call other non-networking RTEMS functions.
</P>
<P><HR>
<LINK REL="Precedes" HREF="networking00029.html">
<LINK REV="Precedes" HREF="networking00027.html">
<LINK REV="Subdocument" HREF="networking00020.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="networking00027.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="networking00020.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="networking00029.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS Network Supplement</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
