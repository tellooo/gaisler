<HTML>
<!-- created Dec 13 2011 from rtc.texi line 26 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>Real-Time Clock Driver Introduction</TITLE>
<LINK REL="Precedes" HREF="bsp_howto00083.html">
<LINK REV="Precedes" HREF="bsp_howto00081.html">
<LINK REV="Subdocument" HREF="bsp_howto00081.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00081.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00081.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00083.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<H2>11.1: Introduction</H2>
<P>
The Real-Time Clock (<STRONG>RTC</STRONG>) driver is responsible for providing an
interface to an <STRONG>RTC</STRONG> device.  [NOTE: In this chapter, the abbreviation
<STRONG>TOD</STRONG> is used for <STRONG>Time of Day</STRONG>.]  The capabilities provided by this
driver are:
</P>
<UL>
<LI>Set the RTC TOD to RTEMS TOD
<LI>Set the RTEMS TOD to the RTC TOD
<LI>Get the RTC TOD
<LI>Set the RTC TOD to the Specified TOD
<LI>Get the Difference Between the RTEMS and RTC TOD
</UL>

<P>
The reference implementation for a real-time clock driver can
be found in <CODE>c/src/lib/libbsp/shared/tod.c</CODE>.  This driver
is based on the libchip concept and can be easily configured
to work with any of the RTC chips supported by the RTC
chip drivers in the directory <CODE>c/src/lib/lib/libchip/rtc</CODE>.
There is a README file in this directory for each supported
RTC chip.  Each of these README explains how to configure the
shared libchip implementation of the RTC driver for that particular
RTC chip.
</P>
<P>
The DY-4 DMV177 BSP used the shared libchip implementation of the RTC
driver.  There were no DMV177 specific configuration routines.  A BSP
could use configuration routines to dynamically determine what type
of real-time clock is on a particular board.  This would be useful for
a BSP supporting multiple board models.  The relevant ports of
the DMV177's <CODE>RTC_Table</CODE> configuration table is below:
</P>
<DL><DT><DD>
<PRE>

#include &lt;bsp.h&gt;
#include &lt;libchip/rtc.h&gt;
#include &lt;libchip/icm7170.h&gt;

bool dmv177_icm7170_probe(int minor);

rtc_tbl	RTC_Table[] = {
  { &quot;/dev/rtc0&quot;,                /* sDeviceName */
    RTC_ICM7170,                /* deviceType */
    &amp;icm7170_fns,               /* pDeviceFns */
    dmv177_icm7170_probe,       /* deviceProbe */
    (void *) ICM7170_AT_1_MHZ,  /* pDeviceParams */
    DMV170_RTC_ADDRESS,         /* ulCtrlPort1 */
    0,                          /* ulDataPort */
    icm7170_get_register_8,     /* getRegister */
    icm7170_set_register_8,     /* setRegister */
  }
};

unsigned long  RTC_Count = (sizeof(RTC_Table)/sizeof(rtc_tbl));
rtems_device_minor_number  RTC_Minor;

bool dmv177_icm7170_probe(int minor)
{
  volatile unsigned16 *card_resource_reg;

  card_resource_reg = (volatile unsigned16 *) DMV170_CARD_RESORCE_REG;

  if ( (*card_resource_reg &amp; DMV170_RTC_INST_MASK) == DMV170_RTC_INSTALLED )
    return TRUE;
  return FALSE;
}

</PRE>
</DL>
<P><HR>
<LINK REL="Precedes" HREF="bsp_howto00083.html">
<LINK REV="Precedes" HREF="bsp_howto00081.html">
<LINK REV="Subdocument" HREF="bsp_howto00081.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00081.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00081.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00083.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
