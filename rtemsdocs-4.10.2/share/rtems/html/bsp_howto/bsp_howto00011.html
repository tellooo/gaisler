<HTML>
<!-- created Dec 13 2011 from makefiles.texi line 72 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>Makefiles Makefiles Used During The BSP Building Process</TITLE>
<LINK REL="Precedes" HREF="bsp_howto00012.html">
<LINK REV="Precedes" HREF="bsp_howto00010.html">
<LINK REV="Subdocument" HREF="bsp_howto00010.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00010.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00010.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00012.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<H2>3.1: Makefiles Used During The BSP Building Process</H2>
<P>
RTEMS uses the <STRONG>GNU automake</STRONG> and <STRONG>GNU autoconf</STRONG> automatic
configuration package.  Consequently, there are a number of
automatically generated files in each directory in the RTEMS
source tree.  The <CODE>bootstrap</CODE> script found in the top level
directory of the RTEMS source tree is executed to produce the
automatically generated files.  That script must be run from
a directory with a <CODE>configure.ac</CODE> file in it.  The <CODE>bootstrap</CODE>
command is usually invoked in one of the following manners:
</P>
<UL>
<LI><CODE>bootstrap</CODE> to regenerate all files that are generated by
autoconf and automake.
<LI><CODE>bootstrap -c</CODE> to remove all files generated by autoconf and
automake.
<LI><CODE>bootstrap -p</CODE> to regenerate <CODE>preinstall.am</CODE> files.
</UL>

<P>
There is a file named <CODE>Makefile.am</CODE> in each directory of
a BSP.  This file is used by <STRONG>automake</STRONG> to produce the file named
<CODE>Makefile.in</CODE> which is also found in each directory of a BSP.
When modifying a <CODE>Makefile.am</CODE>, you can probably find examples of
anything you need to do in one of the BSPs.
</P>
<P>
The configure process specializes the <CODE>Makefile.in</CODE> files at the time that RTEMS
is configured for a specific development host and target.  Makefiles
are automatically generated from the <CODE>Makefile.in</CODE> files.  It is
necessary for the BSP developer to provide the <CODE>Makefile.am</CODE>
files and generate the <CODE>Makefile.in</CODE> files.  Most of the
time, it is possible to copy the <CODE>Makefile.am</CODE> from another
similar directory and edit it.
</P>
<P>
The <CODE>Makefile</CODE> files generated are processed when configuring
and building RTEMS for a given BSP.
</P>
<P>
The BSP developer is responsible for generating <CODE>Makefile.am</CODE>
files which properly build all the files associated with their BSP.
Most BSPs will only have a single <CODE>Makefile.am</CODE> which details
the set of source files to build to compose the BSP support library
along with the set of include files that are to be installed.
</P>
<P>
This single <CODE>Makefile.am</CODE> at the top of the BSP tree specifies
the set of header files to install.  This fragment from the SPARC/ERC32
BSP results in four header files being installed.
</P>
<DL><DT><DD>
<PRE>
include_HEADERS = include/bsp.h
include_HEADERS += include/tm27.h
include_HEADERS += include/erc32.h
include_HEADERS += include/coverhd.h
</PRE>
</DL>
<P>
When adding new include files, you will be adding to the set of
<CODE>include_HEADERS</CODE>.  When you finish editing the <CODE>Makefile.am</CODE>
file, do not forget to run <CODE>bootstrap -p</CODE> to regenerate the
<CODE>preinstall.am</CODE>.
</P>
<P>
The <CODE>Makefile.am</CODE> also specifies which source files to build.
By convention, logical components within the BSP each assign their
source files to a unique variable.  These variables which define
the source files are collected into a single variable which instructs
the GNU autotools that we are building <CODE>libbsp.a</CODE>.  This fragment
from the SPARC/ERC32 BSP shows how the startup related, miscellaneous
support code, and the console device driver source is managed
in the <CODE>Makefile.am</CODE>.
</P>
<DL><DT><DD>
<PRE>
startup_SOURCES = ../../sparc/shared/bspclean.c ../../shared/bsplibc.c \
    ../../shared/bsppredriverhook.c \
    ../../shared/bsppost.c ../../sparc/shared/bspstart.c \
    ../../shared/bootcard.c ../../shared/sbrk.c startup/setvec.c \
    startup/spurious.c startup/erc32mec.c startup/boardinit.S
clock_SOURCES = clock/ckinit.c
...
noinst_LIBRARIES = libbsp.a
libbsp_a_SOURCES = $(startup_SOURCES) $(console_SOURCES) ...
</PRE>
</DL>
<P>
When adding new files to an existing directory, do not forget to add
the new files to the list of files to be built in the corresponding
<CODE>XXX_SOURCES</CODE> variable in the <CODE>Makefile.am</CODE> and run
<CODE>bootstrap</CODE>.
</P>
<P>
Some BSPs use code that is built in <CODE>libcpu</CODE>.  If you BSP does
this, then you will need to make sure the objects are pulled into your
BSP library.  The following from the SPARC/ERC32 BSP pulls in the cache,
register window management and system call support code from the directory
corresponding to its <CODE>RTEMS_CPU</CODE> model.
</P>
<DL><DT><DD>
<PRE>
libbsp_a_LIBADD  = ../../../libcpu/@RTEMS_CPU@/cache.rel \
    ../../../libcpu/@RTEMS_CPU@/reg_win.rel \
    ../../../libcpu/@RTEMS_CPU@/syscall.rel
</PRE>
</DL>
<P>
<STRONG>NOTE:</STRONG> The <CODE>Makefile.am</CODE> files are ONLY processed by
<CODE>bootstrap</CODE> and the resulting <CODE>Makefile.in</CODE> files are only
processed during the configure process of a RTEMS build. Therefore,
when developing a BSP and adding a new file to a <CODE>Makefile.am</CODE>,
the already generated <CODE>Makefile</CODE> will not automatically
include the new references unless you configured RTEMS with the
<CODE>--enable-maintainer-mode</CODE> option.  Otherwise, the new file not
being be taken into account!
</P>
<P><HR>
<LINK REL="Precedes" HREF="bsp_howto00012.html">
<LINK REV="Precedes" HREF="bsp_howto00010.html">
<LINK REV="Subdocument" HREF="bsp_howto00010.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00010.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00010.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00012.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
