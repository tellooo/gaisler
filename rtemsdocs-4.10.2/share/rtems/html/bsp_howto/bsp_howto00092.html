<HTML>
<!-- created Dec 13 2011 from ata.texi line 52 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>ATA Driver Initialization</TITLE>
<LINK REL="Precedes" HREF="bsp_howto00093.html">
<LINK REV="Precedes" HREF="bsp_howto00091.html">
<LINK REV="Subdocument" HREF="bsp_howto00089.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00091.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00089.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00093.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<H2>12.3: Initialization</H2>
<P>
The <CODE>ata_initialize</CODE> routine is responsible for ATA driver
initialization. The main goal of the initialization is to detect and
register in the system all ATA devices attached to IDE controllers
successfully initialized by the IDE Controller driver.
</P>
<P>
In the implementation of the driver, the following actions are performed:
</P>
<DL><DT><DD>
<PRE>
rtems_device_driver ata_initialize(
  rtems_device_major_number  major,
  rtems_device_minor_number  minor,
  void                      *arg
)
{
   initialize internal ATA driver data structure

   for each IDE controller successfully initialized by the IDE Controller
       driver
     if the controller is interrupt driven
       set up interrupt handler

     obtain information about ATA devices attached to the controller
     with help of EXECUTE DEVICE DIAGNOSTIC command

     for each ATA device detected on the controller
       obtain device parameters with help of DEVICE IDENTIFY command

       register new ATA device as new block device in the system
}
</PRE>
</DL>
<P>
Special processing of ATA commands is required because of absence of
multitasking environment during the driver initialization.
</P>
<P>
Detected ATA devices are registered in the system as physical block devices
(see libblock library description). Device names are formed based on IDE
controller minor number device is attached to and device number on the
controller (0 - Master, 1 - Slave). In current implementation 64 minor
numbers are reserved for each ATA device which allows to support up to 63
logical partitions per device.
</P>
<DL><DT><DD>
<PRE>
controller minor    device number    device name    ata device minor
      0                  0             hda                0
      0                  1             hdb               64
      1                  0             hdc              128
      1                  1             hdd              172
     ...                ...            ...
</PRE>
</DL>
<P><HR>
<LINK REL="Precedes" HREF="bsp_howto00093.html">
<LINK REV="Precedes" HREF="bsp_howto00091.html">
<LINK REV="Subdocument" HREF="bsp_howto00089.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00091.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00089.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00093.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
