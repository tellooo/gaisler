<HTML>
<!-- created Dec 13 2011 from shmsupp.texi line 165 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>Shared Memory Support Driver Locking Primitives</TITLE>
<LINK REL="Precedes" HREF="bsp_howto00133.html">
<LINK REV="Precedes" HREF="bsp_howto00131.html">
<LINK REV="Subdocument" HREF="bsp_howto00128.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00131.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00128.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00133.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<H3>16.2.3: Locking Primitives</H3>
<MENU>
<LI><A HREF="bsp_howto00133.html">Shared Memory Support Driver Initializing a Shared Lock</A>
<LI><A HREF="bsp_howto00134.html">Shared Memory Support Driver Acquiring a Shared Lock</A>
<LI><A HREF="bsp_howto00135.html">Shared Memory Support Driver Releasing a Shared Lock</A>
</MENU>
<P>
This is a collection of routines that are invoked by the portable
part of the Shared Memory Driver to manage locks in the shared
memory buffer area.  Accesses to the shared memory must be
atomic.  Two nodes in a multiprocessor system must not be manipulating
the shared data structures simultaneously.  The locking primitives
are used to insure this.
</P>
<P>
To avoid deadlock, local processor interrupts should be disabled the entire
time the locked queue is locked.
</P>
<P>
The locking primitives operate on the lock
<CODE>field</CODE> of the <CODE>Shm_Locked_queue_Control</CODE>
data structure.  This structure is defined as follows:
</P>
<DL><DT><DD>
<PRE>
typedef struct {
  vol_u32 lock;  /* lock field for this queue    */
  vol_u32 front; /* first envelope on queue      */
  vol_u32 rear;  /* last envelope on queue       */
  vol_u32 owner; /* receiving (i.e. owning) node */
} Shm_Locked_queue_Control;
</PRE>
</DL>
<P>
where each field is defined as follows:
</P>
<DL>
<DT><STRONG>lock</STRONG>
<DD>
is the lock field.  Every node in the system must agree on how this
field will be used.  Many processor families provide an atomic
&quot;test and set&quot; instruction that is used to manage this field.

<DT><STRONG>front</STRONG>
<DD>
is the index of the first message on this locked queue.

<DT><STRONG>rear</STRONG>
<DD>
is the index of the last message on this locked queue.

<DT><STRONG>owner</STRONG>
<DD>
is the node number of the node that currently has this structure locked.

</DL>
<P><HR>
<LINK REL="Precedes" HREF="bsp_howto00133.html">
<LINK REV="Precedes" HREF="bsp_howto00131.html">
<LINK REV="Subdocument" HREF="bsp_howto00128.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="bsp_howto00131.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="bsp_howto00128.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="bsp_howto00133.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>BSP and Device Driver Development Guide</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
