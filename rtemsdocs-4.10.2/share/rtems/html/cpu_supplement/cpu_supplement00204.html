<HTML>
<!-- created Dec 13 2011 from sparc.texi line 896 via texi2www -->
<BODY BGCOLOR="FFFFFF">
<A HREF="http://www.rtems.com" target="Text Frame">
  <IMG align=right BORDER=0 SRC="../images/rtems_logo.jpg" ALT="RTEMS Logo"> </A>
<H1>RTEMS 4.10.2 On-Line Library</H1>
<HR>
<HEAD>
<TITLE>SPARC Specific Information Vectoring of Interrupt Handler</TITLE>
<LINK REL="Precedes" HREF="cpu_supplement00205.html">
<LINK REV="Precedes" HREF="cpu_supplement00203.html">
<LINK REV="Subdocument" HREF="cpu_supplement00182.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="cpu_supplement00203.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="cpu_supplement00182.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="cpu_supplement00205.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS CPU Architecture Supplement</CITE></P>
<H3>11.4.2: Vectoring of Interrupt Handler</H3>
<P>
Upon receipt of an interrupt the SPARC automatically
performs the following actions:
</P>
<UL>
<LI>disables traps (sets the ET bit of the psr to 0),

<LI>the S bit of the psr is copied into the Previous
Supervisor Mode (PS) bit of the psr,

<LI>the cwp is decremented by one (modulo the number of
register windows) to activate a trap window,

<LI>the PC and nPC are loaded into local register 1 and 2
(l0 and l1),

<LI>the trap type (tt) field of the Trap Base Register (TBR)
is set to the appropriate value, and

<LI>if the trap is not a reset, then the PC is written with
the contents of the TBR and the nPC is written with TBR + 4.  If
the trap is a reset, then the PC is set to zero and the nPC is
set to 4.
</UL>

<P>
Trap processing on the SPARC has two features which
are noticeably different than interrupt processing on other
architectures.  First, the value of psr register in effect
immediately before the trap occurred is not explicitly saved.
Instead only reversible alterations are made to it.  Second, the
Processor Interrupt Level (pil) is not set to correspond to that
of the interrupt being processed.  When a trap occurs, ALL
subsequent traps are disabled.  In order to safely invoke a
subroutine during trap handling, traps must be enabled to allow
for the possibility of register window overflow and underflow
traps.
</P>
<P>
If the interrupt handler was installed as an RTEMS
interrupt handler, then upon receipt of the interrupt, the
processor passes control to the RTEMS interrupt handler which
performs the following actions:
</P>
<UL>
<LI>saves the state of the interrupted task on it's stack,

<LI>insures that a register window is available for
subsequent traps,

<LI>if this is the outermost (i.e. non-nested) interrupt,
then the RTEMS interrupt handler switches from the current stack
to the interrupt stack,

<LI>enables traps,

<LI>invokes the vectors to a user interrupt service routine (ISR).
</UL>

<P>
Asynchronous interrupts are ignored while traps are
disabled.  Synchronous traps which occur while traps are
disabled result in the CPU being forced into an error mode.
</P>
<P>
A nested interrupt is processed similarly with the
exception that the current stack need not be switched to the
interrupt stack.
</P>
<P><HR>
<LINK REL="Precedes" HREF="cpu_supplement00205.html">
<LINK REV="Precedes" HREF="cpu_supplement00203.html">
<LINK REV="Subdocument" HREF="cpu_supplement00182.html">
<LINK REV="Library" HREF="../index.html">
</HEAD><BODY><P>
<A HREF="cpu_supplement00203.html"><IMG ALIGN=MIDDLE SRC="../images/prev-arrow.gif" ALT="PREV"></A>
<A HREF="cpu_supplement00182.html"> <IMG ALIGN=MIDDLE SRC="../images/up-arrow.gif" ALT="UP"></A>
<A HREF="cpu_supplement00205.html"><IMG ALIGN=MIDDLE SRC="../images/next-arrow.gif" ALT="NEXT"></A>
<A HREF="../index.html"> <IMG ALIGN=MIDDLE SRC="../images/dir-arrow.gif" ALT="Bookshelf"></A>
<CITE>RTEMS CPU Architecture Supplement</CITE></P>
<P>Copyright &copy; 1988-2008 <A HREF="http://www.oarcorp.com" target="Text Frame">OAR Corporation</A>
</BODY></HTML>
